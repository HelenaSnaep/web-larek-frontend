## Документация проекта "Веб-ларек"

**Стек:** HTML, SCSS, TypeScript, Webpack

### Структура проекта:

```
src/ — исходные файлы проекта
src/components/ — папка с компонентами
src/components/base/ — папка с базовыми классами
src/pages/index.html — HTML-файл главной страницы
src/types/index.ts — файл с интерфейсами и типами данных
src/index.ts — точка входа приложения
src/scss/styles.scss — корневой файл стилей
src/utils/constants.ts — файл с константами
src/utils/utils.ts — файл с утилитами
```

### Установка и запуск:

```
npm install
npm run start
```

или

```
yarn
yarn start
```

### Сборка:

```
npm run build
```

или

```
yarn build
```

Архитектура проекта

Проект реализован по архитектуре MVP с использованием брокера событий.

Model — отвечает за данные и бизнес-логику.

View — отображает интерфейс и реагирует на действия пользователя.

Presenter — посредник между моделью и представлением.

Event Broker — реализован через EventEmitter и обеспечивает обмен событиями между компонентами.



#### Принцип работы MVP с брокером событий следующий:

1. Пользователь взаимодействует с представлением.
2. Представление через брокер генерирует событие.
3. Брокер событий передает события в презентер, который подписан на эти события.
4. Презентер обрабатывает событие, взаимодействует с моделью, вызывает методы модели для изменения данных и подписывается на события об изменении данных.
5. Модель меняет состояние, брокер уведомляет об этом презентер.
6. Брокер событий передает события об изменении данных в презентер.
7. Презентер обрабатывает события об изменении данных и вызывает методы представления для обновления отображения данных.
8. Представление отображает данные и ждет новых событий от пользователя.

---

## Базовые классы

### Класс Component

Родительский класс для всех элементов отображения.

**Конструктор:**

* `container: HTMLElement` — DOM-контейнер компонента.

**Методы:**

* `render()` — отрисовывает новый HTML-элемент по полученным в него данным
* `remove()` — удаляет компонент из DOM.
* `show()` — делает компонент видимым.
* `hide()` — скрывает компонент.

### Класс EventEmitter

Класс для обмена событиями между частями приложения, используется для реализации брокера событий в приложении.

Конструктор принимает экземпляр объекта Map и записывает его в свойство _events.

**Методы:**

* `on(event, handler)` — подписка на событие.
* `off(event, handler)` — отписка от события.
* `emit(event, payload)` — вызов события.
* `onAll(handler)` — подписка на все события.
* `offAll()` — удалить все подписки.
* `trigger` - возвращает функцию-триггер, генерирующую событие при вызове.

### Класс Api

Базовый класс для работы с API.

**Конструктор:**

* `baseUrl` - базовый URL API
* `options: RequestInit`- параметры запроса 

**Методы:**

* `handleResponse<T>(res: Response): Promise<T>` — обработка ответа.
* `get<T>(url: string)` — GET-запрос.
* `post<T>(url: string, data: unknown)` — POST-запрос.

---

## Классы Представления

### Класс Card

Компонент карточки. Наследуется от Component и отвечает за отображение карточки товара. В проекте предусмотрено три шаблона карточек template: для галереи товаров на главной странице, для подробного просмотра товара в модальном окне, для отображения товара в списке корзины. По переданному template заполняет информацией, назначая слушатель событий на кнопку или на всю карточку.  



**Конструктор:**

* container - ссылка на DOM-элемент
* actions - - хранилище событий

**Поля:**

* `_image` — изображение карточки
* `_title` — отображение заголовка карточки 
* `_price` — цена
* `_description` — описание
* `_category` — категория
* `_button` —  отвечает за отображение кнопки карточки

**Методы и сеттеры:**

* `id` — устанавливает `data-id` контейнера
* `title`, `description`, `category`, `image`, `price`, `button` — отображают соответствующие поля товара


### Класс Form

Класс Form наследуется от класса Component и отвечает за отображение формы. Принимает любую форму, позволяет проводить валидацию этой формы и управлять отображением доступных кнопок на основании валидности формы, в этом заключается универсальность этого класса.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий


**Методы:**

* onInputChange - отвечает за обработку изменений ввода
* render - отвечает за отображение формы


**Сеттеры:**

* valid - отключает кнопку сабмита
* errors - отображает ошибки



### Класс Success

Класс Success наследуется от класса Component. Не имеет полей, но есть кнопка, которая отвечает за отображение сообщения об успешном выполнении операции при оплате товара


**Конструктор:**

* container - ссылка на DOM-элемент
* actions - объект с функцией-обработчиком события закрытия (onClick).

**Поля:**

* _close: HTMLElement — кнопка, при нажатии на которую пользователь закрывает модальное окно и возвращается к каталогу товаров.




### Класс Page

Класс Page наследуется от класса Component. Управляет отображением каталога, счетчиком корзины и блокировкой интерфейса.


**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий

**Поля:**
* _counter- счетчик товаров в корзине 
* _catalog - каталог продуктов 
* _basket - кнопка с иконкой корзины
* _wrapper - обёртка страницы — блокируется при модалках


**Сеттеры:**

* _counter - счетчик товаров в корзине 
* _locked - блокирует прокрутку страницы при открытом модальном окне




### Класс Basket

Класс Basket наследуется от класса Component и отвечает за отображение корзины.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий


**Поля:**

* items - содержит элементы корзины 
* total - содержит общую стоимость 


**Сеттеры:**

* items - отвечает за отображение карточек в корзине
* total - отвечает за отображение общей стоимости


**Методы:**

* submitButtonLock - отвечает за блокировку кнопки оформления заказа




### Класс Modal

Класс Modal наследуется от класса Component. Будет родительским классом для всех модальных окон, которые будут созданы в проекте. Содержит общий функционал всех модальных окон.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий

**Методы**

* open - открывает модальное окно
* close - закрывает модальное окно
* render - отвечает за отображение модального окна

---


## Классы моделей


### Класс AppData

Хранит все данные приложения, массив всех продуктов, корзину, данные о заказе, который оформляет пользователь.
Конструктор класса принимает экземпляр класса   EventEmitter. 

**Поля:**

* catalog: IProduct[] — массив всех товаров.

* basket: IBasket — объект корзины с полями item: string[] (id товаров) и total: number.

* order: IOrder — объект текущего заказа с полями: email, phone, address, payment, items.

* preview: IProduct | null — текущий выбранный товар для превью.

* formErrors: FormErrors — объект с ошибками валидации форм.


Содержит следующие **Методы и сеттеры** для работы с данными:

* `setItems` сохранение массива данных, получаемых с сервера и взывает событие 'items:changed' изменение данных о товарах

* `setPreview` - устанавливает превью товара, принимает элемент товара который хотим просмотреть и вызывает событие preview:changed

* `inBasket` проверяет, добавлен ли указанный товар в корзину

* `addToBasket` добавляет товар в корзину, если он ещё не добавлен. После обновления пересчитывает сумму заказа и отправляет событие basket:changed.

* `removeFromBasket` удаляет товар из корзины
 если в заказе верно указаны все данные, устанавливает окно с оформленным заказом

 * `updateTotal` получает итоговую сумму заказа

* `validateOrder` валидирует заказ, проверяет наличие данных покупателя

* `setPayment` устанавливает способ оплаты заказа, отправляет событие  order:updated

* `setOrderField` устанавливает значение в поле для заказа

* `setFormError` устанавливает значение одного из полей заказа и отправляет событие form:error с описанием.

* `clearBasket` очищает корзину, вызывает событие basket:changed


## Типы данных

```ts

export interface IProduct {
  id: string;
  name: string;
  description: string;
  price: number | null;
  image: string;
  category: string;
}


export interface IBasket {
  item: string[];
  total: number;
}


export type PaymentMethod = 'cash' | 'card';



export interface IOrderForm {
	email: string;
	phone: string;
	address: string;
	payment: PaymentMethod;
}

export interface IOrder extends IOrderForm {
	items: string[];
}

export type FormErrors = Partial<Record<keyof IOrderForm, string>>;


export interface IOrderResult {
	id: string;
    total: number;
}
```

---

> 