## Документация проекта "Веб-ларек"

**Стек:** HTML, SCSS, TypeScript, Webpack

### Структура проекта:

```
src/ — исходные файлы проекта
src/components/ — папка с компонентами
src/components/base/ — папка с базовыми классами
src/pages/index.html — HTML-файл главной страницы
src/types/index.ts — файл с интерфейсами и типами данных
src/index.ts — точка входа приложения
src/scss/styles.scss — корневой файл стилей
src/utils/constants.ts — файл с константами
src/utils/utils.ts — файл с утилитами
```

### Установка и запуск:

```
npm install
npm run start
```

или

```
yarn
yarn start
```

### Сборка:

```
npm run build
```

или

```
yarn build
```

Архитектура проекта

Проект реализован по архитектуре MVP с использованием брокера событий.

Model — отвечает за данные и бизнес-логику.

View — отображает интерфейс и реагирует на действия пользователя.

Presenter — посредник между моделью и представлением.

Event Broker — реализован через EventEmitter и обеспечивает обмен событиями между компонентами.



#### Принцип работы MVP с брокером событий следующий:

1. Пользователь взаимодействует с представлением.
2. Представление через брокер генерирует событие.
3. Брокер событий передает события в презентер, который подписан на эти события.
4. Презентер обрабатывает событие, взаимодействует с моделью, вызывает методы модели для изменения данных и подписывается на события об изменении данных.
5. Модель меняет состояние, брокер уведомляет об этом презентер.
6. Брокер событий передает события об изменении данных в презентер.
7. Презентер обрабатывает события об изменении данных и вызывает методы представления для обновления отображения данных.
8. Представление отображает данные и ждет новых событий от пользователя.

---

## Базовые классы

### Класс Component

Базовый класс для всех компонентов UI.

**Конструктор:**

* `container: HTMLElement` — DOM-контейнер компонента.

**Методы:**

* `render()` — отрисовывает компонент.
* `remove()` — удаляет компонент из DOM.
* `show()` — делает компонент видимым.
* `hide()` — скрывает компонент.

### Класс EventEmitter

Класс для обмена событиями между частями приложения.

**Поля:**

* `_events: хранилище событий приложения`

**Методы:**

* `on(event, handler)` — подписка на событие.
* `off(event, handler)` — отписка от события.
* `emit(event, payload)` — вызов события.
* `onAll(handler)` — подписка на все события.
* `offAll()` — удалить все подписки.
* `trigger(event)` — возвращает функцию-триггер события.

**События:**

* `catalog:changed` = генерируется при изменении каталога приложения. 
* `card:select` - генерируется при открытии модалки карточки
* `card:changed` - генерируется при добавлении товара в корзину
* `basket:open` - генерируется при открытии корзины
* `basket:changed` - генерируется при редактировании корзины
* `removeFromBasket` - генерируется при удалении карточки из корзины
* `order:open` - генерируется при переходе на форму заказа
* `order:submit` - генерируется при переходе на форму контактов
* `contacts:submit` - генерируется при отправке заказа
* `modal:open` - генерируется при открытии модалки
* `modal:close` - генерируется при закрытии модалки

### Класс Api

Базовый класс для работы с API.

**Конструктор:**

* `baseUrl` - базовый URL API
* `options: RequestInit`- параметры запроса 

**Методы:**

* `handleResponse<T>(res: Response): Promise<T>` — обработка ответа.
* `get<T>(url: string)` — GET-запрос.
* `post<T>(url: string, data: unknown)` — POST-запрос.

---

## Классы Представления

### Класс Card

Компонент карточки товара. Наследуется от Component и отвечает за отображение карточки товара. 


**Конструктор:**

* container - ссылка на DOM-элемент
* actions - - хранилище событий

**Поля:**

* `_image` — изображение карточки
* `_title` — отображение заголовка карточки 
* `_price` — цена
* `_description` — описание
* `_category` — категория
* `_button` —  отвечает за отображение кнопки карточки

**Методы и сеттеры:**

* `id` — устанавливает `data-id` контейнера
* `title`, `description`, `category`, `image`, `price`, `button` — отображают соответствующие поля товара


### Класс Form

Класс Form наследуется от класса Component и отвечает за отображение формы. Принимает любую форму, позволяет проводить валидацию этой формы и управлять отображением доступных кнопок на основании валидности формы, в этом заключается универсальность этого класса.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий


**Методы:**

* onInputChange - отвечает за обработку изменений ввода
* render - отвечает за отображение формы


**Сеттеры:**

* valid - отключает кнопку сабмита
* errors - отображает ошибки



### Класс Success

Класс Success наследуется от класса Component. Не имеет полей, но есть кнопка, которая отвечает за отображение сообщения об успешном выполнении операции при оплате товара


**Конструктор:**

* container - ссылка на DOM-элемент
* actions - объект с функцией-обработчиком события закрытия (onClick).

**Поля:**

* _close: HTMLElement — кнопка, при нажатии на которую пользователь закрывает модальное окно и возвращается к каталогу товаров.




### Класс Page

Класс Page наследуется от класса Component. Управляет отображением каталога, счетчиком корзины и блокировкой интерфейса.


**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий

**Поля:**
* _counter- количество продуктов в корзине 
* _catalog - каталог продуктов 
* _preview - выбранный продукт 
* _basket - корзина 


**Сеттеры:**

* _counter - счетчик товаров в корзине 
* _locked - блокирует прокрутку страницы при открытом модальном окне




### Класс Basket

Класс Basket наследуется от класса Component и отвечает за отображение корзины.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий


**Поля:**

* items - содержит элементы корзины 
* total - содержит общую стоимость 


**Сеттеры:**

* items - отвечает за отображение карточек в корзине
* total - отвечает за отображение общей стоимости


**Методы:**

* submitButtonLock - отвечает за блокировку кнопки оформления заказа




### Класс Modal

Класс Modal наследуется от класса Component. Будет родительским классом для всех модальных окон, которые будут созданы в проекте. Содержит общий функционал всех модальных окон.

**Конструктор:**

* container - ссылка на DOM-элемент
* events  - - хранилище событий

**Методы**

* open - открывает модальное окно
* close - закрывает модальное окно
* render - отвечает за отображение модального окна

---


## Классы моделей


### Класс AppData

Хранит все данные приложения, массив всех продуктов, корзину, данные о заказе, который оформляет пользователь.
Конструктор класса принимает экземпляр класса   EventEmitter. 

**Поля:**

* catalog: IProduct[] — массив всех товаров.

* basket: IBasket — объект корзины с полями item: string[] (id товаров) и total: number.

* order: IOrder — объект текущего заказа с полями: email, phone, address, payment, items.

* preview: IProduct | null — текущий выбранный товар для превью.

* formErrors: FormErrors — объект с ошибками валидации форм.


Содержит следующие **Методы и сеттеры** для работы с данными:

* addItemToBasket- добавляет товар в корзину, принимает элемент товара
* removeItemFromBasket- удаляет товар из корзины, принимает элемент товара
* clearBasket- очищает корзину
* getBasket- возвращает товары, которые находятся в корзине
* getTotal- получает итоговую сумму заказа
* setCatalog- устанавливает каталог товаров, принимает массив товаров
* setPreview- устанавливает превью товара, принимает элемент товара
* setOrderField- если в заказе верно указаны все данные, устанавливает окно с оформленным заказом
* validateOrder- валидирует заказ, проверяет наличие данных покупателя




## Типы данных

```ts

export interface IProduct {
  id: string;
  name: string;
  description: string;
  price: number | null;
  image: string;
  category: string;
}


export interface IBasket {
  item: string[];
  total: number;
}


export type PaymentMethod = 'cash' | 'card';



export interface IOrderForm {
	email: string;
	phone: string;
	address: string;
	payment: PaymentMethod;
}

export interface IOrder extends IOrderForm {
	items: string[];
}

export type FormErrors = Partial<Record<keyof IOrderForm, string>>;


export interface IOrderResult {
	id: string;
    total: number;
}
```

---

> 